import{_ as K,e as v,a as t,w as e,j as C,b as c,t as g,k as V,g as w,c as p,u as z,f as y,i as J,l as q,F as j,m as _,n as H,p as Q,q as W,s as D,v as Y,d as X,o as h,x as Z,y as x,z as b,A as P,B as S,C as L,D as ee,E as te,G as ae,H as O,I as R,J as se,V as T,K as $,L as le,M as ne,N as re,O as de,P as ie,Q as oe}from"./index-CfvEuYu0.js";import{u as B}from"./useRefreshLogin-CybLTn05.js";const ue={key:0,class:"opacity-50 font-italic ms-4"},ce={class:"font-weight-bold"},ge={key:0,class:"action-buttons d-flex w-100"},{refreshLogin:he}=B(),fe={data:()=>({alertVisible:!1,alertMessage:"Meow",alertType:"info",tab:"recent",tabs:[{value:"recent",text:"Recent",content:[]},{value:"subjects",text:"By Subject",content:[]}],activePanels:[],gradesSubjects:[],gradesAll:[],editEnabled:!1,editGradeId:"",initGradeValue:0,newGradeValue:0,averageOverall:0}),mounted(){this.getGrades()},methods:{async getGrades(){const d=localStorage.getItem("token"),o=localStorage.getItem("url");if(localStorage.getItem("url")==null)this.alertType="error",this.alertMessage="Not logged in! Go to the Account page to log in first.",this.showAlert();else{let a={"Content-Type":"application/x-www-form-urlencoded",Authorization:`Bearer ${d}`},n=await fetch(`${o}api/3/marks/`,{method:"GET",headers:a}),s=await n.json();if(console.log(s),n.ok==!1)await he(),await this.getGrades();else{let r=Object.values(s),i=r.values();for(const l of i);let f=[],M=0;for(let l=0;l<r[0].length;l++){f.push(...r[0][l].Marks);let k=0,m=0;for(let u=0;u<r[0][l].Marks.length;u++)/\d/.test(r[0][l].Marks[u].MarkText)&&(r[0][l].Marks[u].MarkText.endsWith("-")?(k=k+(parseInt(r[0][l].Marks[u].MarkText.slice(0,-1))+.5)*parseInt(r[0][l].Marks[u].Weight),m=m+parseInt(r[0][l].Marks[u].Weight)):(k=k+parseInt(r[0][l].Marks[u].MarkText)*parseInt(r[0][l].Marks[u].Weight),m=m+parseInt(r[0][l].Marks[u].Weight)));let G=r[0][l].TemporaryMark==null||r[0][l].TemporaryMark.trim()===""?"None":r[0][l].TemporaryMark,E=[];for(let u=r[0][l].Marks.length-1;u>=0;u--){let U=Date.parse(r[0][l].Marks[u].MarkDate),F=new Date(U);E.push({Id:r[0][l].Marks[u].Id,grade:r[0][l].Marks[u].MarkText,weight:r[0][l].Marks[u].Weight,description:r[0][l].Marks[u].Caption,classRank:r[0][l].Marks[u].ClassRankText,theme:r[0][l].Marks[u].Theme,date:F.toLocaleString(void 0,{year:"numeric",month:"numeric",day:"numeric"})})}m==0&&(m=1);let N=Math.round((k/m+Number.EPSILON)*100)/100;M=M+N,this.gradesSubjects.push({title:r[0][l].Subject.Name,average:N,temporary:G,content:E})}let I=f.sort(function(l,k){var m=new Date(l.MarkDate),G=new Date(k.MarkDate);return m-G}).reverse(),A;for(let l=0;l<I.length;l++){A=r[0].find(G=>G.Subject.Id===I[l].SubjectId).Subject.Name;let k=Date.parse(I[l].MarkDate),m=new Date(k);this.gradesAll.push({grade:I[l].MarkText,weight:I[l].Weight,description:I[l].Caption,subject:A,date:m.toLocaleString(void 0,{year:"numeric",month:"numeric",day:"numeric"})})}this.averageOverall=Math.round((M/this.gradesSubjects.length+Number.EPSILON)*100)/100}}},editGrade(d,o,a){this.editEnabled=!this.editEnabled,this.editGradeId=d,this.newGradeValue=o,this.newWeightValue=a},updateGrade(){const d=this.findIndex(this.editGradeId);this.gradesSubjects[d.subjectIndex].content[d.markIndex].grade=this.newGradeValue,this.gradesSubjects[d.subjectIndex].content[d.markIndex].weight=this.newWeightValue,this.editEnabled=!this.editEnabled,this.updateAverage(d.subjectIndex)},findIndex(d){for(let o=0;o<this.gradesSubjects.length;o++)for(let a=0;a<this.gradesSubjects[o].content.length;a++)if(this.gradesSubjects[o].content[a].Id==d)return{subjectIndex:o,markIndex:a};return null},updateAverage(d){let o=0,a=0;for(let s=0;s<this.gradesSubjects[d].content.length;s++)/\d/.test(this.gradesSubjects[d].content[s].grade)&&(this.gradesSubjects[d].content[s].grade.endsWith("-")?(o=o+(parseInt(this.gradesSubjects[d].content[s].grade.slice(0,-1))+.5)*parseInt(this.gradesSubjects[d].content[s].weight),a=a+parseInt(this.gradesSubjects[d].content[s].weight)):(o=o+parseInt(this.gradesSubjects[d].content[s].grade)*parseInt(this.gradesSubjects[d].content[s].weight),a=a+parseInt(this.gradesSubjects[d].content[s].weight)));let n=Math.round((o/a+Number.EPSILON)*100)/100;this.averageOverall=Math.round((this.averageOverall*this.gradesSubjects.length-this.gradesSubjects[d].average+n)/this.gradesSubjects.length*100)/100,this.gradesSubjects[d].average=n},addGrade(d){this.newGradeId="predictor_"+window.crypto.randomUUID(),this.newGradeDesc="Custom",this.newGradeValue="N",this.newGradeWeight=1;const o=new Date,a=o.getFullYear();let n=o.getMonth()+1,s=o.getDate();s<10&&(s="0"+s),n<10&&(n="0"+n);const r=s+"/"+n+"/"+a;this.gradesSubjects[d].content.push({Id:this.newGradeId,date:r,description:this.newGradeDesc,grade:this.newGradeValue,weight:this.newGradeWeight}),this.updateAverage(d)},showAlert(){this.alertVisible=!0},deleteGrade(d,o){const a=this.findIndex(d);this.gradesSubjects[o].content.splice(a.markIndex,1),this.updateAverage(o)}}},me=Object.assign(fe,{__name:"Grades",setup(d){const{isRefreshing:o}=B();return(a,n)=>(h(),v(j,null,[t(V,{class:"justify-center align-center"},{default:e(()=>[t(C,{class:"mb-2"},{default:e(()=>[c(" Average Grade: "+g(a.averageOverall),1)]),_:1})]),_:1}),t(X,{class:"d-flex flex-column justify-center page-container"},{default:e(()=>[z(o)?(h(),v("p",ue,[t(J,{indeterminate:"",size:24}),n[7]||(n[7]=y("span",{class:"ms-4"},"Refreshing login token...",-1))])):w("",!0),t(q,{modelValue:a.tab,"onUpdate:modelValue":n[0]||(n[0]=s=>a.tab=s),grow:"",class:"mb-4"},{default:e(()=>[(h(!0),v(j,null,_(a.tabs,s=>(h(),p(Z,{key:s.value,value:s.value},{default:e(()=>[c(g(s.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),a.alertVisible?(h(),p(H,{key:1,type:a.alertType},{default:e(()=>[c(g(a.alertMessage),1)]),_:1},8,["type"])):w("",!0),t(Q,{modelValue:a.tab,"onUpdate:modelValue":n[6]||(n[6]=s=>a.tab=s)},{default:e(()=>[t(W,{key:"recent",value:"recent"},{default:e(()=>[t(D,{lines:"two",rounded:""},{default:e(()=>[(h(!0),v(j,null,_(a.gradesAll,s=>(h(),p(x,{key:s},{default:e(()=>[t(V,{class:"align-center mb-2 flex-nowrap"},{default:e(()=>[t(b,{cols:"2",sm:"1",class:"ms-2 text-center"},{default:e(()=>[t(P,{class:"text-h5"},{default:e(()=>[c(g(s.grade),1)]),_:2},1024)]),_:2},1024),t(b,{class:"flex-fill"},{default:e(()=>[y("p",ce,g(s.subject),1),t(S,null,{default:e(()=>[c(g(s.description),1)]),_:2},1024)]),_:2},1024),t(b,{cols:"4",class:"d-flex bg-surface align-end align-lg-center ga-lg-2 flex-lg-row-reverse flex-column mb-lg-2"},{default:e(()=>[t(C,{class:"mb-2 mb-lg-0",color:"light-blue","prepend-icon":"mdi-weight"},{default:e(()=>[c(g(s.weight),1)]),_:2},1024),t(S,{class:"mb-2 mb-lg-0"},{default:e(()=>[c(g(s.date),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(L)]),_:2},1024))),128))]),_:1})]),_:1}),t(W,{key:"subjects",value:"subjects"},{default:e(()=>[t(Y,{multiple:"",modelValue:a.activePanels,"onUpdate:modelValue":n[5]||(n[5]=s=>a.activePanels=s)},{default:e(()=>[(h(!0),v(j,null,_(a.gradesSubjects,(s,r)=>(h(),p(ee,{key:s},{default:e(()=>[t(te,{color:a.activePanels.includes(r)?"surface-light":""},{default:e(()=>[t(b,{"no-gutters":""},{default:e(()=>[t(V,{class:"text-h5 mb-2"},{default:e(()=>[c(g(s.title),1)]),_:2},1024),t(V,{class:"text-caption"},{default:e(()=>[c("Average grade: "+g(s.average),1)]),_:2},1024),t(V,{class:"text-caption"},{default:e(()=>[c("Temporary grade: "+g(s.temporary),1)]),_:2},1024)]),_:2},1024),t(b,{class:"text-right text-h6"},{default:e(()=>[c(g(s.content.length),1)]),_:2},1024)]),_:2},1032,["color"]),t(ae,{class:"subject-panel"},{default:e(()=>[t(D,{lines:"two"},{default:e(()=>[(h(!0),v(j,null,_(s.content,i=>(h(),p(x,{key:i,class:"grade-item"},{default:e(()=>[t(V,{class:"align-center mb-1 flex-nowrap position-relative",onClick:f=>i.showActions=!i.showActions},{default:e(()=>[t(b,{cols:"auto",sm:"1",class:"ms-2 text-center"},{default:e(()=>[a.editEnabled&&a.editGradeId==i.Id?w("",!0):(h(),p(P,{key:0,class:"text-h6","mb-2":"","mb-lg-0":""},{default:e(()=>[c(g(i.grade),1)]),_:2},1024)),a.editEnabled&&a.editGradeId==i.Id?(h(),p(O,{key:1,modelValue:a.newGradeValue,"onUpdate:modelValue":n[1]||(n[1]=f=>a.newGradeValue=f),variant:"outlined",class:"text-xs-center",dense:"","hide-details":"",onKeyup:n[2]||(n[2]=R(f=>a.updateGrade(),["enter"]))},null,8,["modelValue"])):w("",!0)]),_:2},1024),t(b,{class:"flex-fill"},{default:e(()=>[t(S,null,{default:e(()=>[c(g(i.description),1)]),_:2},1024),a.debugmodecheck?(h(),p(S,{key:0},{default:e(()=>[c(g(i.Id),1)]),_:2},1024)):w("",!0)]),_:2},1024),t(b,{cols:"3",class:"d-flex align-end align-lg-center ga-lg-2 flex-lg-row-reverse flex-column mb-lg-2"},{default:e(()=>[a.editEnabled&&a.editGradeId==i.Id?w("",!0):(h(),p(C,{key:0,class:"mb-2 mb-lg-0",color:"light-blue","prepend-icon":"mdi-weight"},{default:e(()=>[c(g(i.weight),1)]),_:2},1024)),a.editEnabled&&a.editGradeId==i.Id?(h(),p(O,{key:1,modelValue:a.newWeightValue,"onUpdate:modelValue":n[3]||(n[3]=f=>a.newWeightValue=f),variant:"outlined",class:"ma-0 pa-0",dense:"","hide-details":"",onKeyup:n[4]||(n[4]=R(f=>a.updateGrade(),["enter"]))},null,8,["modelValue"])):w("",!0),t(S,{class:"mb-2 mb-lg-0"},{default:e(()=>[c(g(i.date),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]),i.showActions?(h(),v("div",ge,[t(V,{"no-gutters":""},{default:e(()=>[t(b,{class:"pa-1"},{default:e(()=>[t(se,null,{activator:e(({props:f})=>[t(T,$({ref_for:!0},f,{icon:"mdi-pencil-outline",rounded:"",block:"",variant:"tonal",color:"light-green",class:"pa-1"}),null,16)]),default:e(()=>[t(D,null,{default:e(()=>[t(x,{"prepend-icon":"mdi-pencil-outline",title:"Edit Grade",onClick:f=>a.editGrade(i.Id,i.grade,i.weight)},null,8,["onClick"]),i.Id.includes("predictor")?(h(),p(x,{key:0,"prepend-icon":"mdi-trash-can-outline",title:"Delete Grade",onClick:f=>a.deleteGrade(i.Id,r)},null,8,["onClick"])):w("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(b,{class:"pa-1"},{default:e(()=>[t(le,{"max-width":"500"},{activator:e(({props:f})=>[t(T,$({ref_for:!0},f,{icon:"mdi-menu",rounded:"",block:"",variant:"tonal",color:"light-green",class:"pa-1"}),null,16)]),default:e(({isActive:f})=>[t(ne,{title:"Details"},{default:e(()=>[t(re,null,{default:e(()=>[y("p",null,[n[8]||(n[8]=y("strong",null,"Theme:",-1)),c(" "+g(i.theme&&i.theme.length>1?i.theme:"N/A"),1)]),y("p",null,[n[9]||(n[9]=y("strong",null,"Class Rank:",-1)),c(" "+g(i.classRank&&i.classRank.length>1?i.classRank:"N/A"),1)])]),_:2},1024),t(de,null,{default:e(()=>[t(ie),t(T,{text:"Close",onClick:M=>f.value=!1},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)])):w("",!0),t(L)]),_:2},1024))),128)),t(V,{"no-gutters":"",class:"justify-center align-center"},{default:e(()=>[t(b,{cols:"5",color:"light-green"},{default:e(()=>[t(T,{color:"light-blue",variant:"tonal","append-icon":"mdi-text-box-plus-outline",rounded:"",block:"",onClick:i=>a.addGrade(r)},{default:e(()=>n[10]||(n[10]=[c("Add Grade")])),_:2,__:[10]},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})],64))}}),pe=K(me,[["__scopeId","data-v-a90b4da3"]]),we={__name:"Grades",setup(d){return(o,a)=>(h(),v(j,null,[t(oe,{title:"Grades",class:"bg-transparent"}),t(pe)],64))}};export{we as default};
