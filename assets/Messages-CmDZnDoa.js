import{u as v}from"./useRefreshLogin-CybLTn05.js";import{_ as C,c as m,w as s,e as c,g as y,a as l,u as I,f as T,i as x,m as _,F as h,l as j,p as L,d as R,o as r,x as A,b as u,t as d,q as B,n as D,M as F,W as O,X as P,Y as w,Z as U,N as W,Q as z}from"./index-CfvEuYu0.js";const E={key:0,class:"opacity-50 font-italic ms-4"},G={class:"ma-2 my-4"},{refreshLogin:H}=v(),q={data:()=>({alertVisible:!1,alertMessage:"Meow",alertType:"info",tab:"received",tabs:[{value:"received",text:"Received",unreads:0,content:[]},{value:"noticeboard",text:"Noticeboard",unreads:0,content:[]}]}),mounted(){this.getMessages()},methods:{async getMessages(){const g=localStorage.getItem("token"),p=localStorage.getItem("url");if(localStorage.getItem("messagetype")==null&&localStorage.setItem("messagetype","received"),localStorage.getItem("url")==null)this.alertType="error",this.alertMessage="Not logged in! Go to the Account page to log in first.",this.showAlert();else for(let e=0;e<this.tabs.length;e++){let t=this.tabs[e].value,n={"Content-Type":"application/x-www-form-urlencoded",Authorization:`Bearer ${g}`},f=await fetch(`${p}api/3/komens/messages/${t}/`,{method:"POST",headers:n}),b=await(await fetch(`${p}api/3/komens/messages/${t}/unread/`,{method:"GET",headers:n})).json(),k=await f.json();if(isNaN(b)||b==0?this.tabs[e].unreads="No":this.tabs[e].unreads=b,f.ok==!1)await H(),await this.getMessages();else{let i=Object.values(k);for(let o=i[0].length-1;o>=0;o--){let V=i[0][o].Title;V==""&&(V="No title");let M=i[0][o].Text.trim(),N=i[0][o].RelevantName,S=i[0][o].RelevantPersonType,$=Date.parse(i[0][o].SentDate);var a=new Date($);this.tabs[e].content.push({title:`${V}`,date:`${a.toLocaleString()}`,author:`${N} (${S})`,content:`${M}`})}}}},unwrapSpans(g){return g.replace(/<\/?span[^>]*>/g,"").replace(/^(<br \/>)+|(<br \/>)+$/g,"").replace(/<(\w+)[^>]*>/g,"<$1>")},showAlert(){this.alertVisible=!0}}},J=Object.assign(q,{__name:"Messages",setup(g){const{isRefreshing:p}=v();return(a,e)=>(r(),m(R,{class:"d-flex flex-column justify-center page-container"},{default:s(()=>[I(p)?(r(),c("p",E,[l(x,{indeterminate:"",size:24}),e[2]||(e[2]=T("span",{class:"ms-4"},"Refreshing login token...",-1))])):y("",!0),l(j,{modelValue:a.tab,"onUpdate:modelValue":e[0]||(e[0]=t=>a.tab=t),grow:""},{default:s(()=>[(r(!0),c(h,null,_(a.tabs,t=>(r(),m(A,{key:t.value,value:t.value},{default:s(()=>[u(d(t.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),l(L,{modelValue:a.tab,"onUpdate:modelValue":e[1]||(e[1]=t=>a.tab=t)},{default:s(()=>[(r(!0),c(h,null,_(a.tabs,t=>(r(),m(B,{key:t.value,value:t.value},{default:s(()=>[T("p",G,d(t.unreads)+" unread messages",1),a.alertVisible?(r(),m(D,{key:0,type:a.alertType},{default:s(()=>[u(d(a.alertMessage),1)]),_:1},8,["type"])):y("",!0),(r(!0),c(h,null,_(t.content,(n,f)=>(r(),m(F,{key:f,class:"my-4"},{default:s(()=>[l(O,{class:"bg-surface-light"},{default:s(()=>[l(P,null,{default:s(()=>[u(d(n.title),1)]),_:2},1024),l(w,null,{default:s(()=>[u(" From: "+d(n.author),1)]),_:2},1024),l(w,null,{default:s(()=>[l(U,null,{default:s(()=>e[3]||(e[3]=[u("mdi-inbox")])),_:1,__:[3]}),u(" "+d(n.date),1)]),_:2},1024)]),_:2},1024),l(W,{innerHTML:a.unwrapSpans(n.content),class:"pt-4"},null,8,["innerHTML"])]),_:2},1024))),128))]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}))}}),Q=C(J,[["__scopeId","data-v-7917a0a3"]]),K={__name:"Messages",setup(g){return(p,a)=>(r(),c(h,null,[l(z,{title:"Messages",class:"bg-transparent"}),l(Q)],64))}};export{K as default};
