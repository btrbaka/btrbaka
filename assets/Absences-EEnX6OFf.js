import{u as m}from"./useRefreshLogin-CybLTn05.js";import{_ as k,c as d,w as g,e as p,g as u,a as l,u as y,f as T,i as _,n as w,b as S,t as A,T as h,d as V,o as i,Q as j,F as v}from"./index-CfvEuYu0.js";const C={key:0,class:"opacity-50 font-italic ms-4"},{refreshLogin:L}=m(),M={data:()=>({alertVisible:!1,alertMessage:"Meow",alertType:"info",headersTotal:[{title:"Unsolved",align:"center",key:"unsolved"},{title:"Ok",align:"center",key:"ok"},{title:"Missed",align:"center",key:"missed"},{title:"Late",align:"center",key:"late"},{title:"Soon",align:"center",key:"soon"},{title:"School",align:"center",key:"school"},{title:"Distance",align:"center",key:"distance"}],itemsTotal:[{unsolved:0,ok:0,missed:0,late:0,soon:0,school:0,distance:0}],headers:[{title:"Subject",align:"start",key:"subject"},{title:"Absence",align:"center",key:"missed"},{title:"Missed",align:"end",key:"percentage"}],items:[]}),mounted(){this.getAbsences()},methods:{async getAbsences(){const o=localStorage.getItem("token"),a=localStorage.getItem("url");if(localStorage.getItem("url")==null)this.alertType="error",this.alertMessage="Not logged in! Go to the Account page to log in first.",this.showAlert();else{let s={"Content-Type":"application/x-www-form-urlencoded",Authorization:`Bearer ${o}`},n=await fetch(`${a}api/3/absence/student/`,{method:"GET",headers:s}),f=await n.json();if(n.ok==!1)await L(),await this.getAbsences();else{let t=Object.values(f),b=t.values();for(const e of b)console.log(e);if(t[1]!=null)for(let e=0;e<t[1].length;e++)this.itemsTotal[0].unsolved+=t[1][e].Unsolved,this.itemsTotal[0].ok+=t[1][e].Ok,this.itemsTotal[0].missed+=t[1][e].Missed,this.itemsTotal[0].late+=t[1][e].Late,this.itemsTotal[0].soon+=t[1][e].Soon,this.itemsTotal[0].school+=t[1][e].School,this.itemsTotal[0].distance+=t[1][e].DistanceTeaching;for(let e=0;e<t[2].length;e++){const r=t[2][e].Base+t[2][e].Late+t[2][e].Soon+t[2][e].School+t[2][e].DistanceTeaching;let c=0;t[2][e].LessonsCount>0&&(c=parseFloat((r/t[2][e].LessonsCount*100).toFixed(2))),this.items.push({subject:`${t[2][e].SubjectName}`,missed:`${r} | ${t[2][e].LessonsCount}`,percentage:`${c} %`})}}}},rowStyling(o){const a=o.internalItem.columns.percentage;return{class:parseFloat(a.replace("%","").trim())>20?"text-red-accent-3":""}},showAlert(){this.alertVisible=!0}}},N=Object.assign(M,{__name:"Absences",setup(o){const{isRefreshing:a}=m();return(s,n)=>(i(),d(V,{class:"d-flex flex-column justify-center page-container"},{default:g(()=>[y(a)?(i(),p("p",C,[l(_,{indeterminate:"",size:24}),n[0]||(n[0]=T("span",{class:"ms-4"},"Refreshing login token...",-1))])):u("",!0),s.alertVisible?(i(),d(w,{key:1,type:s.alertType},{default:g(()=>[S(A(s.alertMessage),1)]),_:1},8,["type"])):u("",!0),l(h,{headers:s.headersTotal,items:s.itemsTotal,"header-props":{class:"bg-surface-light"},"disable-sort":"",class:"mb-4"},null,8,["headers","items"]),l(h,{headers:s.headers,items:s.items,"header-props":{class:"bg-surface-light"},"row-props":s.rowStyling},null,8,["headers","items","row-props"])]),_:1}))}}),$=k(N,[["__scopeId","data-v-b459e7fd"]]),F={__name:"Absences",setup(o){return(a,s)=>(i(),p(v,null,[l(j,{title:"Absences",class:"bg-transparent"}),l($)],64))}};export{F as default};
