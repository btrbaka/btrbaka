import{u as j}from"./useRefreshLogin-CybLTn05.js";import{_ as K,c as v,w as h,e as u,g as F,a as p,u as X,f as i,i as Y,m as T,F as g,l as Z,n as ee,b as M,t as d,p as te,d as se,o as n,x as ae,q as le,R as ne,S as oe,Q as re}from"./index-CfvEuYu0.js";const ie={key:0,class:"opacity-50 font-italic ms-4"},ue={class:"text-center text-h6"},ce={class:"text-no-wrap text-subtitle-2 text-center text-medium-emphasis"},de={class:"position-sticky left-0 bg-surface-light text-center pa-2"},me={class:"text-h6 text-bold"},he={class:"text-break text-medium-emphasis"},{refreshLogin:fe}=j(),ge={data:()=>({alertVisible:!1,alertMessage:"Meow",alertType:"info",days:["Monday","Tuesday","Wednesday","Thursday","Friday"],timeSlots:[],tab:"current",tabs:[{value:"previous",text:"Previous",content:[]},{value:"current",text:"Current",content:[]},{value:"next",text:"Next",content:[]}]}),mounted(){let c=new Date().getTime(),a=c-6084e5,r=c+6084e5;this.getSchedule(this.tabs[0].content,a,!1),this.getSchedule(this.tabs[1].content,c,!0),this.getSchedule(this.tabs[2].content,r,!1)},methods:{async getSchedule(b,c,a){const r=new Date(parseInt(c)).toISOString().split("T")[0],o=localStorage.getItem("token"),m=localStorage.getItem("url");if(localStorage.getItem("url")==null)this.alertType="error",this.alertMessage="Not logged in! Go to the Account page to log in first.",this.showAlert();else{let f={"Content-Type":"application/x-www-form-urlencoded",Authorization:`Bearer ${o}`},x=await fetch(`${m}api/3/timetable/actual?date=${r}`,{method:"GET",headers:f});var N=await x.json();if(x.ok==!1)await fe(),await this.getSchedule(b,c);else{let e=Object.values(N),H=e.values();for(const t of H)console.log(t);if(a)for(let t=0;t<e[0].length;t++)this.timeSlots.push({title:e[0][t].Caption,range:e[0][t].BeginTime+" - "+e[0][t].EndTime});for(let t=0;t<e[1].length;t++){let y=[];if(e[1][t].DayType=="Holiday")for(let s=0;s<e[0].length;s++)y.push({className:"Holiday",classNameFull:"Holiday",teacher:"",teacherFull:"N/A",room:"",change:"holiday"});else if(e[1][t].DayType=="Celebration")for(let s=0;s<e[0].length;s++)y.push({className:"Celebration",classNameFull:"Celebration",teacher:"",teacherFull:"N/A",room:"",change:"holiday"});else for(let s=0;s<e[1][t].Atoms.length;s++){let I,S,C,_,w,A=null;e[1][t].Atoms[s].Change?(e[1][t].Atoms[s].RoomId?I=e[6].find(l=>l.Id===e[1][t].Atoms[s].RoomId).Abbrev+"; "+e[1][t].Atoms[s].Change.Description:I=e[1][t].Atoms[s].Change.Description,e[1][t].Atoms[s].Change.ChangeType!="Canceled"?A="canceled":A="other"):I=e[6].find(l=>l.Id===e[1][t].Atoms[s].RoomId).Abbrev;const V=new Date,D=V.getHours(),B=String(V.getMinutes()).padStart(2,"0"),R=`${D}:${B}`,$=e[0].find(l=>l.Id===e[1][t].Atoms[s].HourId).BeginTime,E=e[0].find(l=>l.Id===e[1][t].Atoms[s].HourId).EndTime,[O,z]=R.split(":").map(Number),k=O*60+z,[L,P]=$.split(":").map(Number),U=L*60+P,[W,G]=E.split(":").map(Number),q=W*60+G,Q=V.toISOString().split("T")[0],J=e[1][t].Date.split("T")[0];Q===J&&a&&k>=U&&k<=q&&(A+=" active"),e[1][t].Atoms[s].SubjectId==null?S="N/A":(S=e[4].find(l=>l.Id===e[1][t].Atoms[s].SubjectId).Abbrev,C=e[4].find(l=>l.Id===e[1][t].Atoms[s].SubjectId).Name),e[1][t].Atoms[s].TeacherId==null?(_="N/A",w="N/A"):(_=e[5].find(l=>l.Id===e[1][t].Atoms[s].TeacherId).Abbrev,w=e[5].find(l=>l.Id===e[1][t].Atoms[s].TeacherId).Name),s>0&&e[1][t].Atoms[s-1].HourId!=e[1][t].Atoms[s].HourId-1&&y.push({className:"",classNameFull:"",teacher:"",teacherFull:"No information",room:"",change:""}),y.push({className:S,classNameFull:C,teacher:_,teacherFull:w,room:I,change:A})}b.push(y)}}}}}},pe=Object.assign(ge,{__name:"Schedule",setup(b){const{isRefreshing:c}=j();return(a,r)=>(n(),v(se,{class:"d-flex flex-column justify-center page-container"},{default:h(()=>[X(c)?(n(),u("p",ie,[p(Y,{indeterminate:"",size:24}),r[2]||(r[2]=i("span",{class:"ms-4"},"Refreshing login token...",-1))])):F("",!0),p(Z,{modelValue:a.tab,"onUpdate:modelValue":r[0]||(r[0]=o=>a.tab=o),grow:"",class:"mb-4"},{default:h(()=>[(n(!0),u(g,null,T(a.tabs,o=>(n(),v(ae,{key:o.value,value:o.value},{default:h(()=>[M(d(o.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),a.alertVisible?(n(),v(ee,{key:1,type:a.alertType},{default:h(()=>[M(d(a.alertMessage),1)]),_:1},8,["type"])):F("",!0),p(te,{modelValue:a.tab,"onUpdate:modelValue":r[1]||(r[1]=o=>a.tab=o)},{default:h(()=>[(n(!0),u(g,null,T(a.tabs,o=>(n(),v(le,{key:o,value:o.value},{default:h(()=>[p(ne,{class:"rounded"},{default:h(()=>[i("thead",null,[i("tr",null,[r[3]||(r[3]=i("th",{class:"position-sticky left-0 bg-surface-light"},null,-1)),(n(!0),u(g,null,T(a.timeSlots,m=>(n(),u("th",{key:m.title,class:"bg-surface-light"},[i("div",ue,d(m.title),1),i("div",ce,d(m.range),1)]))),128))])]),i("tbody",null,[(n(!0),u(g,null,T(a.days,(m,N)=>(n(),u("tr",null,[i("td",de,d(m.substring(0,3).toUpperCase()),1),(n(!0),u(g,null,T(o.content[N],f=>(n(),u("td",{class:oe(["pa-2 subject-cell",f.change])},[i("div",me,d(f.className),1),i("div",null,d(f.teacher),1),i("div",he,d(f.room),1)],2))),256))]))),256))])]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}))}}),be=K(pe,[["__scopeId","data-v-1097ade0"]]),Ie={__name:"Schedule",setup(b){return(c,a)=>(n(),u(g,null,[p(re,{title:"Schedule",class:"bg-transparent"}),p(be)],64))}};export{Ie as default};
